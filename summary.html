<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏ì‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</title>
  <link rel="stylesheet" href="summary.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <header>
    <h1>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏ì‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h1>
  </header>

  <main>
    <div id="winnerBox" class="winner-box"></div>

    <table id="summaryTable">
      <thead>
        <tr>
          <th>‡∏Ñ‡∏ì‡∏∞‡∏™‡∏µ</th>
          <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

    <!-- ‚úÖ Firebase SDK ‡πÅ‡∏ö‡∏ö UMD (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 8) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>


  <footer>
    <p>¬© ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ï‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå |<a href="report.html"> ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a></p>
  </footer>

<script>
  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDwmeumgDSVlspe7gIcF6rVbe-hBye7Q3I",
    authDomain: "school-scores-8e9eb.firebaseapp.com",
    databaseURL: "https://school-scores-8e9eb-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "school-scores-8e9eb",
    storageBucket: "school-scores-8e9eb.firebasestorage.app",
    messagingSenderId: "416720346956",
    appId: "1:416720346956:web:b20e84af0b635b374279e9",
    measurementId: "G-DD7E1RFNC1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function calculateSummary() {
    // ‚úÖ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ì‡∏∞‡∏ó‡∏±‡πâ‡∏á 5 (‡∏™‡∏∞‡∏Å‡∏î‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö teacher.html)
    const faculties = [
      "‡∏°‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏¥‡∏£‡∏∏‡∏ì",
      "‡πÑ‡∏û‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏´‡∏≤‡∏™",
      "‡πÇ‡∏≠‡∏†‡∏≤‡∏™‡∏£‡∏ß‡∏µ",
      "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏≠‡∏≥‡πÑ‡∏û",
      "‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏î‡∏≤‡∏£‡∏≤"
    ];

    // ‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ì‡∏∞
    const totals = {};
    faculties.forEach(f => totals[f] = 0);

    // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
    db.ref("scores").on("value", (snapshot) => {
      const data = snapshot.val() || {};

      // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡πÉ‡∏´‡∏°‡πà
      faculties.forEach(f => totals[f] = 0);

      for (let key in data) {
        const item = data[key];
        if (totals[item.faculty] !== undefined) {
          totals[item.faculty] += item.value;
        }
      }

      // ‡∏´‡∏≤‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
      let winner = null;
      let maxScore = -Infinity;
      faculties.forEach(f => {
        if (totals[f] > maxScore) {
          maxScore = totals[f];
          winner = f;
        }
      });

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞
      const winnerBox = document.getElementById("winnerBox");
      if (winner) {
        winnerBox.innerHTML = `üèÜ <strong>${winner}</strong> ‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° ${maxScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
      } else {
        winnerBox.innerHTML = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ";
      }

      // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏£‡∏ö 5 ‡∏Ñ‡∏ì‡∏∞
      const tbody = document.getElementById("summaryTable").querySelector("tbody");
      tbody.innerHTML = "";
      faculties.forEach(f => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${f}</td>
          <td>${totals[f]}</td>
        `;
        tbody.appendChild(row);
      });
    });
  }

  calculateSummary();
</script>
</body>
</html>
